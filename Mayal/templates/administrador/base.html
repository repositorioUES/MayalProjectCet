<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        {% block title %}<title></title>{% endblock title%}

        <!-- PARA EL SELECT MULTIPLE Y AJAX -->
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.full.min.js" defer></script>
            {% comment %} <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" integrity="sha512-nMNlpuaDPrqlEls3IX/Q56H36qvBASwb3ipuo3MxeWbsQB1881ox0cRv7UPTgBlriqoynt35KjEwgGUeUXIPnw==" crossorigin="anonymous" referrerpolicy="no-referrer" /> {% endcomment %}

        <!---->

        <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
        {% load static %}
		<link rel="stylesheet" href="{% static 'css/styles.css' %}">
        <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
    </head>

            <!-- Seccion NAVBAR-->
            {% block navbar %}
                {% include 'administrador/navbar.html' %}
            {% endblock navbar %}
            <!-- Fin Seccion NAVBAR-->
        
            <!-- Seccion SIDEBAR-->
            {% block sidebar %}
                {% include 'administrador/sidebar.html' %}
            {% endblock sidebar %}
            <!-- Fin Seccion SIDEBAR-->

            <!-- Seccion BODY-->

            <div id="layoutSidenav_content">
                <main>
                    {% block content %}
                    <div class="container-fluid px-4">
                        <h1 class="mt-4">Dashboard</h1>
                        <ol class="breadcrumb mb-4">
                            <li class="breadcrumb-item active">Dashboard</li>
                        </ol>
                        <div class="row">
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body">Primary Card</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-warning text-white mb-4">
                                    <div class="card-body">Warning Card</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-success text-white mb-4">
                                    <div class="card-body">Success Card</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card bg-danger text-white mb-4">
                                    <div class="card-body">Danger Card</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xl-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-area me-1"></i>
                                        Area Chart Example
                                    </div>
                                    <div class="card-body"><canvas id="myAreaChart" width="100%" height="40"></canvas></div>
                                </div>
                            </div>
                            <div class="col-xl-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-1"></i>
                                        Bar Chart Example
                                    </div>
                                    <div class="card-body"><canvas id="myBarChart" width="100%" height="40"></canvas></div>
                                </div>
                            </div>
                        </div>

                        <!-- ZONA PARA EL CHATBOT ================================================================================================================= -->
                        <!-- Icono para abrir y cerrar el chat -->
                        <label>
                            <i  class="fab fa-facebook-messenger" id="msn" onclick="mostrar()"
                                style="position:absolute; right:30px; bottom:50px; height:35px; width:35px; background:#da79af; color:#fff; padding:10px; border-radius:50px;
                                        cursor:pointer; transition: all 0.4s ease;">ChatBot</i>
                            <i  class="fab fa-facebook-messenger" id="msn" onclick="mostrar()"
                                style="position:absolute; right:30px; bottom:50px; height:35px; width:35px; background:#da79af; color:#fff; padding:10px; border-radius:50px;
                                        cursor:pointer; transition: all 0.4s ease;"></i>
                            <i  class="fas fa-times" id="ex" onclick="ocultar()"
                                style="position:absolute; right:30px; bottom:50px; height:35px; width:35px; background:#da79af; color:#fff; padding:10px; border-radius:50px;
                                        cursor:pointer; transition: all 0.4s ease;"></i>
                        </label>
                        <!-- FIN Icono para abrir y cerrar el chat -->
                        <!-- Contenedor del chatbot -->
                        <div  id="container" style="position: absolute; right: 30px; bottom:110px; max-height:600px; background:#fff; padding:10px; border-radius:12px; box-shadow: 0px 15px 20px rgba(0,0,0,0.5);">
                            <div  id="chat_place" style="max-width:500px; max-height:475px; overflow:auto; background:#fff; padding:10px;">
                                <div class="alert alert-warning" role="alert" style="width:350px; margin-right: 10px; background:#da79af; color:#000" opacity="0.1">
                                    <table>
                                        <tr>
                                            <td>
                                                <strong>May-Bot</strong>
                                                <br>
                                                <span class="text"> Hola! Soy May-Bot, Si tienes dudas puedes preguntarme</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            <!-- FIN del Contenedor del chatbot -->
                            <!-- Textfield -->
                            <div>    
                                <input type="textfiled"  placeholder="Preguntale a May-Bot" name="message" id="msj" size="45" style="" on>
                            
                                <button type="submit" class="btn btn-info" onclick="getChat()" style="margin:10px;" ><i class="fa fa-paper-plane"
                                    aria-hidden="true"></i> Enviar</button>
                            </div>
                        </div>
                        <!-- FIN ZONA PARA EL CHATBOT ================================================================================================================= -->
                    </div>
                </main>
                {% endblock content %}
                <!-- Fin Seccion BODY-->

                <!-- Seccion FOOTER-->
                {% block js %}
                    {% include 'administrador/footer.html' %}

                    <!-- AJAX PARA EL CHATBOT ========================================================================== -->
                    <script type="text/javascript">
                        //Ejecutar funcion al carga la p[agina
                        window.onload = ocultar();

                        // Disparar la accion al darle al Enter
                        $(document).ready(function() {    
                            $('#msj').keypress(function(e){   
                            if(e.which == 13){      
                                getChat();      
                            }   
                            });    
                            
                        });
                        
                        var texto = ""; // Striong para ir concat los mensajes
                        function getChat(){
                            var message = $("#msj").val();
                            if (message){
                                
                                var request = $.ajax({
                                    type: "GET",
                                    url: "{% url 'chat' %}",
                                    data: {
                                        "message":message
                                    },
                                });
                                request.done(function(response){
                                    texto += response;
                                    $("#chat_place").html(texto);
                                    var toBottom = document.getElementById("chat_place");
                                    toBottom.scrollTop = toBottom.scrollHeight;
                                });
                                document.getElementById("msj").value = "";
                            }   
                        }

                        function ocultar(){
                            document.getElementById('container').style.display = 'none';
                            document.getElementById('ex').style.display = 'none';
                            document.getElementById('msn').style.display = 'inline';
                        }

                        function mostrar(){
                            document.getElementById('container').style.display = 'inline';
                            document.getElementById('msn').style.display = 'none';
                            document.getElementById('ex').style.display = 'inline';
                        }

                    </script>
                    <!-- FIN AJAX PARA EL CHATBOT ========================================================================== -->

                {% endblock js %}
                <!-- Fin Seccion FOOTER-->

            </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script type="text/javascript" src="{% static 'js/scripts.js' %}"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
        <script type="text/javascript" src="{% static 'assets/chart-area-demo.js' %}"></script>
        <script type="text/javascript" src="{% static 'assets/chart-bar-demo.js' %}"></script>
        <script type="text/javascript" src="{% static 'assets/chart-pie-demo.js' %}"></script>
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
        <script type="text/javascript" src="{% static 'js/datatables-simple-demo.js' %}"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

        {% block mensajesJS %}
            <!-- Funcion para imprimir mensajes  -->
            {% if messages%}
                {% for m in messages%}
                    <script>
                        swal({
                            icon: 'success',
                            text: '{{ m }}',
                            timer: 3000,
                        });
                    </script>
                {%endfor%}
            {% endif %}
        {% endblock mensajesJS %}
    </body>
</html>
